$(function(){function i(i){return function(e,n){var s=e[i];return n[i]-s}}!function(){$("header>.nav-back").on("click",function(){window.history.go(-1)});var e=localStorage.getItem("scanWifi");scanEntity=JSON.parse(e),console.log(e),console.log(scanEntity);var n=scanEntity.Scan;n.sort(i("signal")),console.log(n),console.log(scanEntity.Scan),console.log(scanEntity);var s=template("listTmp",scanEntity);$("#selectCon").html(s),console.log("点击下拉按钮之前渲染本地数据到页面成功"),console.log($("#selectCon").html()),$.each(n,function(i,e){$.each(n[i],function(e,s){if(""===n[i][e]&&(console.log("不合法的wifi信息数据-------d"),console.log(i),console.log(n)),("security"===e&&"OPEN"===s||"security"===e&&"NONE"===s)&&$("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(1)").css("display","none"),"signal"===e)switch(!0){case s>=75:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_01.png"),!1;case s>=50:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_02.png"),!1;case s>=25:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_03.png"),!1;case s>=0:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_04.png"),!1}})});var c=JSON.stringify(scanEntity);localStorage.setItem("scanWifi",c),console.log(localStorage)}();var e=$("#wifi-list>.wifi-password>input[type='text']"),n=$("#wifi-list>.wifi-amplifier>#newWifiName"),s=$("#wifi-list>.amplifier-password>#newPassword");$("#wifi-list>.wifi-name>.wifi-l").text(scanEntity.Scan[0].ssid),e.attr("placeholder",'请输入"'+scanEntity.Scan[0].ssid+'"的密码'),wifiObj=scanEntity.Scan[0],wifiData="Channel="+wifiObj.Channel+"&ssid="+wifiObj.ssid+"&bssid="+wifiObj.bssid+"&security="+wifiObj.security+"&signal="+wifiObj.signal+"&mode="+wifiObj.mode+"&ext_ch="+wifiObj.ext_ch+"&net_type="+wifiObj.net_type+"&wps="+wifiObj.wps,console.log("成功获取被点击的wifi的相关信息："+wifiData),ssidName=wifiObj.ssid,console.log("获取了被点击的wifi名:"+ssidName),n.val(ssidName+"-Plus"),s.attr("placeholder","请输入"+ssidName+"-Plus的密码"),e.on("input",function(){s.val(e.val())}),n.on("input",function(){s.attr("placeholder","请输入"+n.val()+"的密码")}),$("#wifi-list>.wifi-name>.wifi-r>.list-btn").on("click",function(i){var e=localStorage.getItem("scanWifi");scanEntity=JSON.parse(e),console.log(scanEntity);var n=scanEntity.Scan;$.each(n,function(i,e){$.each(n[i],function(e,n){if("signal"===e)switch(console.log(n),!0){case n>=75:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_01.png"),!1;case n>=50:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_02.png"),!1;case n>=25:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_03.png"),!1;case n>=0:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_04.png"),!1}("security"===e&&"OPEN"===n||"security"===e&&"NONE"===n)&&$("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(1)").css("display","none")})}),i.stopPropagation(),$("#selectCon").select()}),$("#wifi-list>.wifi-name>.wifi-r>.refresh-btn").on("click",function(e){$.ajax({url:"/cgi-bin/wifi_setting.cgi",type:"POST",data:"wifiScan=Scan",async:!1,success:function(e){response=JSON.parse(e),console.log("11111111111111111");var n=response.Scan;n.sort(i("signal"));console.log(n),console.log(response.Scan),console.log(response);var s=template("listTmp",response);$("#selectCon").html(s),console.log(s),console.log("将模板数据渲染到页面成功"),$.each(n,function(i,e){$.each(n[i],function(e,n){if("signal"===e)switch(console.log(n),!0){case n>=75:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_01.png"),!1;case n>=50:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_02.png"),!1;case n>=25:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_03.png"),!1;case n>=0:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_04.png"),!1}("security"===e&&"OPEN"===n||"security"===e&&"NONE"===n)&&$("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(1)").css("display","none")})});var c=JSON.stringify(response);localStorage.setItem("scanWifi",c),console.log(localStorage),console.log("刷新按钮获取服务器的wifi列表数据成功")}}),e.stopPropagation(),$(".selectContainer").select()}),$("#wifi-form>#wifi-list>.same-password>.cBox").on("click",function(){$(this).find("input[type='checkbox']").prop("checked")?$("#wifi-list>.password-management").hide(300):$("#wifi-list>.password-management").show(300)}),$("#wifi-form").validate({rules:{wifiPassword:{emptyCheck:!0},newWifiName:{emptyCheck:!0,minlength:1,maxlength:26},newPassword:{emptyCheck:!0,manageCodeCheck:!0},managePassword:{emptyCheck:!0,manageCodeCheck:!0}},messages:{wifiPassword:{emptyCheck:"输入不能为空"},newWifiName:{emptyCheck:"输入不能为空"},newPassword:{emptyCheck:"输入不能为空",manageCodeCheck:"有效密码为8-64位字符"},managePassword:{emptyCheck:"输入不能为空",manageCodeCheck:"有效密码为8-64位字符"}},success:function(i){i.parent().parent().css({"border-color":"#ddd"})},errorPlacement:function(i,e){console.log(e),console.log(i),i.appendTo(e.siblings("p")),e.parent().css({"border-color":"#EE2222"})}}),$("#wifi-form>#wifi-list>#next-bnt").click(function(){var i=$("#wifi-form").valid();if(console.log(i),i){var c={};c.mac=wifiObj.bssid,c.wifiName=wifiObj.ssid,c.wifiPwd=e.val(),c.newWifiName=n.val(),c.newPassword=s.val(),$("#samePassword").prop("checked")?(c.wmcheckedVal=!0,c.managePassword=s.val()):(c.wmcheckedVal=!1,c.managePassword=$("managePassword").val()),e.val()==s.val()?c.wzcheckedVal=!0:c.wzcheckedVal=!1;var t=JSON.stringify(c);localStorage.setItem("ChosenWifi",t),$.ajax({type:"POST",url:"/cgi-bin/wifi_setting.cgi",data:"wifiCommit=commit&"+wifiData+"&"+$("#wifi-form").serialize(),error:function(i,e){console.log("提交表单失败服务端返回的数据---------"+e),console.log("error:"+e)},success:function(i){console.log("提交表单数据成功后服务端返回的数据------------"+i),console.log("提交表单数据成功"),"wifiSettingSuccess"==i&&(window.location.href="configuration.html")}})}})});