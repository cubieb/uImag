$(function(){function i(i){return function(n,e){var c=n[i];return e[i]-c}}!function(){$("header>.nav-back").on("click",function(){window.history.go(-1)}),$.ajax({url:"/cgi-bin/wifi_setting.cgi",type:"POST",data:"wifiScan=Scan",async:!1,success:function(i){console.log("管理界面的首页跳转到路由设置界面成功"),console.log(i),localStorage.setItem("scanWifi",i)},error:function(i){console.log("管理界面的首页跳转到路由设置界面失败")}});var n=localStorage.getItem("scanWifi");console.log(n),scanEntity=JSON.parse(n),console.log(n);var e=scanEntity.Scan;$.each(e,function(i,n){$.each(e[i],function(n,c){if("signal"==n)switch(!0){case c>=-80:e[i][n]="优";break;case c>=-85:e[i][n]="良";break;case c>=-90:e[i][n]="中";break;case c>=-110:e[i][n]="差";break;default:console.log("信号强度不在以上范围内")}})}),console.log(e);var c=$.isEmptyObject(JSON.parse(localStorage.getItem("OtherChosen")));if(console.log(c),c){var o=localStorage.getItem("ChosenWifi"),t=JSON.parse(o);console.log(t);var s=t.mac,l=t.wifiPwd;$.each(e,function(i,n){$.each(e[i],function(n,c){"bssid"==n&&c==s&&(wifiObj=e[i],$("#wifiName>.wifi-l").text(e[i].ssid),$("#wifiPwd").val(l),$("#signalStrength").val(e[i].signal),$("#encrypt").val(e[i].security),$("#mac").val(s))})})}else{var a=localStorage.getItem("OtherChosen"),r=JSON.parse(a);console.log(r),wifiObj=r,console.log(wifiObj),$("#wifiName>.wifi-l").text(r.ssid),$("#wifiPwd").val(r.wifiPwd),$("#signalStrength").val(r.signal),$("#encrypt").val(r.security),$("#mac").val(r.bssid)}e.sort(i("signal")),console.log(scanEntity.Scan);var g=template("listTmp",scanEntity);$("#selectCon").html(g),console.log("点击下拉按钮之前渲染本地数据到页面成功"),console.log($("#selectCon").html()),$.each(e,function(i,n){$.each(e[i],function(n,c){if(""===e[i][n]&&(console.log("不合法的wifi信息数据-------d"),console.log(i),console.log(e)),("security"===n&&"OPEN"===c||"security"===n&&"NONE"===c)&&$("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(1)").css("display","none"),"signal"===n)switch(!0){case c>=75:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_01.png"),!1;case c>=50:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_02.png"),!1;case c>=25:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_03.png"),!1;case c>=0:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_04.png"),!1}})});var h=JSON.stringify(scanEntity);localStorage.setItem("scanWifi",h),console.log(localStorage)}(),wifiData="Channel="+wifiObj.Channel+"&ssid="+wifiObj.ssid+"&bssid="+wifiObj.bssid+"&security="+wifiObj.security+"&signal="+wifiObj.signal+"&mode="+wifiObj.mode+"&ext_ch="+wifiObj.ext_ch+"&net_type="+wifiObj.net_type+"&wps="+wifiObj.wps,console.log("成功获取被点击的wifi的相关信息："+wifiData),$("#wifiName>.wifi-r>.list-btn").on("click",function(i){var n=localStorage.getItem("scanWifi");scanEntity=JSON.parse(n),console.log(scanEntity);var e=scanEntity.Scan;$.each(e,function(i,n){$.each(e[i],function(n,e){if("signal"===n)switch(console.log(e),!0){case e>=75:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_01.png"),!1;case e>=50:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_02.png"),!1;case e>=25:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_03.png"),!1;case e>=0:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_04.png"),!1}("security"===n&&"OPEN"===e||"security"===n&&"NONE"===e)&&$("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(1)").css("display","none")})}),i.stopPropagation(),$("#selectCon").select(),$("#signalStrength").val(wifiObj.signal),$("#encrypt").val(wifiObj.security),$("#mac").val(wifiObj.bssid)}),$("#wifiName>.wifi-r>.refresh-btn").on("click",function(n){$.ajax({url:"/cgi-bin/wifi_setting.cgi",type:"POST",data:"wifiScan=Scan",async:!1,success:function(n){response=JSON.parse(n),console.log("response");var e=response.Scan;e.sort(i("signal"));console.log(e),console.log(response.Scan),console.log(response);var c=template("listTmp",response);$("#selectCon").html(c),console.log(c),console.log("将模板数据渲染到页面成功"),$.each(e,function(i,n){$.each(e[i],function(n,e){if("signal"===n)switch(console.log(e),!0){case e>=75:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_01.png"),!1;case e>=50:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_02.png"),!1;case e>=25:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_03.png"),!1;case e>=0:return $("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(2)").attr("src","images/02_icon03_04.png"),!1}("security"===n&&"OPEN"===e||"security"===n&&"NONE"===e)&&$("#selectCon>ul>li:nth-child("+(i+1)+")>img:nth-child(1)").css("display","none")})});var o=JSON.stringify(response);localStorage.setItem("scanWifi",o),console.log(localStorage),console.log("刷新按钮获取服务器的wifi列表数据成功")}}),n.stopPropagation(),$(".selectContainer").select()}),$("#main>form").validate({rules:{wifiPwd:{emptyCheck:!0}},messages:{wifiPwd:{emptyCheck:"输入不能为空"}},success:function(i){i.parent().parent().css({"border-color":"#ddd"})},errorPlacement:function(i,n){console.log(n),console.log(i),i.appendTo(n.siblings("p")),n.parent().css({"border-color":"#EE2222"})}}),$("#main>form>button>a").on("click",function(){var i=$("#wifiPwd").val(),n=$("#main>form").valid();return console.log(n),n&&$.ajax({type:"POST",url:"/cgi-bin/wifi_setting.cgi",data:"station_commit=commit&routePwd="+i+"&"+wifiData,error:function(i){console.log("提交当前路由设置信息失败")},success:function(n){console.log(n),console.log("提交当前路由设置信息成功");var e=wifiObj;e.wifiPwd=i,console.log(e);var c=JSON.stringify(e);localStorage.setItem("OtherChosen",c),"routeSuccess"==n&&layer.open({title:["提示","background-color:#438cff; color:#fff;"],anim:"up",content:"是否前往修改扩展WiFi信息？",btn:["确定","取消"],yes:function(i){window.location.href="manage_navWiFi_setting.html"},no:function(i){$.ajax({type:"POST",url:"/cgi-bin/sys_setting.cgi",data:"reboot_sys=reboot",error:function(){console.log("开始重启系统......失败！")},success:function(i){console.log("开始重启系统......成功！"),console.log(i),"reboot"==i&&(window.location.href="syetem_reboot_progress.html")}})},success:function(i){console.log(i),$(".layui-m-layersection>.layui-m-layerchild").append("<div class='popup-close'></div>"),$(".layui-m-layersection>.layui-m-layerchild>.popup-close").on("click",function(){$(i).css({display:"none"})})}})}}),!1})});